import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { NgClass, NgStyle } from '@angular/common';
import { TypingDirective } from '../directives/typing.directive';
import { FormsModule } from '@angular/forms';
import { InputTextModule } from 'primeng/inputtext';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@angular/forms";
import * as i3 from "primeng/inputtext";
export class ChatbotTextboxComponent {
    constructor(http) {
        this.http = http;
        this.closeChatbot = new EventEmitter();
        this.welcomeMessage = 'Hello I\'m Manu your virtual assistant. How can I help you?';
        this.errorMessage = 'Something went wront. Please try later';
        this.waitingResponse = false;
        this.errorResponse = false;
        this.listOfMessages = [
            { role: 'assistant', content: this.welcomeMessage }
        ];
    }
    getIcon(ind) {
        return (ind == 0 || ind % 2 == 0) ? this.icons.chatbotIcon : this.icons.userIcon;
    }
    onCloseChatbot() {
        this.closeChatbot.emit();
    }
    onSendForm() {
        if (this.inputText != undefined) {
            this.listOfMessages.push({ role: 'user', content: this.inputText });
            this.inputText = undefined;
            this.waitingResponse = true;
            //Remove the welcome message
            const request = { model: "gpt-3.5-turbo", messages: this.listOfMessages.slice(1) };
            //Do the call
            this.http.post(this.basePath, request)
                .subscribe({
                next: (res) => {
                    this.waitingResponse = false;
                    if (res.content) {
                        this.listOfMessages.push({ role: 'assistant', content: res.content });
                    }
                },
                error: (err) => {
                    this.waitingResponse = false;
                    this.errorResponse = true;
                    this.listOfMessages.push({ role: 'assistant', content: this.errorMessage });
                }
            });
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: ChatbotTextboxComponent, deps: [{ token: i1.HttpClient }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.12", type: ChatbotTextboxComponent, isStandalone: true, selector: "lib-chatbot-textbox", inputs: { icons: "icons", basePath: "basePath" }, outputs: { closeChatbot: "closeChatbot" }, viewQueries: [{ propertyName: "bodyContainer", first: true, predicate: ["bodyChatbotContainer"], descendants: true }], ngImport: i0, template: "<div class=\"header\">\r\n    <p class=\"header-text\">My chatbot title</p>\r\n    <span class=\"icon-right\"\r\n    (click)=\"onCloseChatbot()\">\r\n      <i class=\"pi pi-times\"></i>\r\n    </span>\r\n  </div>\r\n  \r\n  <div #bodyChatbotContainer \r\n  class=\"body\">\r\n  \r\n  \r\n    @for (chat of  listOfMessages ; track chat; let index=$index )\r\n    {\r\n      <div class=\"chat-container-message\"\r\n      [ngStyle]=\"{'flex-direction': index === 0 || index % 2 === 0 ? 'row' : 'row-reverse'}\"\r\n      >\r\n        <img [src]=\"getIcon(index)\" class=\"svg-container\" alt=\"\" \r\n        [ngClass]=\"index === 0 || index % 2 === 0 ? 'chatbot-icon' : 'user-icon' \" >\r\n        @if(index == 0)\r\n        {\r\n          <p class=\"chatbot-text chat-message\">{{chat.content}}</p>\r\n        }@else {\r\n          @if (index % 2 == 0) {\r\n            <p libTyping [text]=\"chat.content\"\r\n            [ngClass]=\"errorResponse ? 'chat-error' : 'chat-message' \"\r\n            [nativeContainer]=\"bodyChatbotContainer\"\r\n            class=\"chatbot-text\">\r\n              {{chat.content}}\r\n            </p>          \r\n          } @else {\r\n            <p class=\"chatbot-text user-message\">{{chat.content}}</p>\r\n          }\r\n  \r\n        }\r\n      </div>\r\n    }\r\n  \r\n    @if(waitingResponse)\r\n    {  \r\n      <div class=\"chat-container-message\">\r\n        <img [src]=\"icons.chatbotIcon\" class=\"svg-container chatbot-icon\" alt=\"\">\r\n        <div class=\"spinner\">\r\n          <div class=\"bounce1\"></div>\r\n          <div class=\"bounce2\"></div>\r\n          <div class=\"bounce3\"></div>\r\n        </div>\r\n      </div>\r\n    }\r\n  \r\n  </div>\r\n  \r\n  <hr class=\"horizontal-line\">\r\n  <div class=\"footer\">\r\n  \r\n    <input type=\"text\" pInputText\r\n    placeholder=\"Write here your message...\"\r\n    [disabled]=\"waitingResponse\"\r\n    [style]=\"{'border-radius' : '20px' , 'font-size' : 'small' , 'width' : '85%'}\"\r\n    [(ngModel)]=\"inputText\"\r\n    (keydown.enter)=\"onSendForm()\"\r\n    />\r\n  \r\n    <div class=\"send-icon-container\"\r\n    [class.disabled-icon]=\"!inputText\"\r\n    (click)=\"onSendForm()\">\r\n      <i class=\"pi pi-send\"></i>\r\n    </div>\r\n  \r\n  </div>\r\n  \r\n  \r\n  ", styles: [":host{width:25rem;height:35rem;display:flex;flex-direction:column;overflow:hidden;border-radius:10px;position:absolute;right:1rem;bottom:2rem;background-color:var(--bg-textbox);box-shadow:#00000026 1.95px 1.95px 2.6px;animation:onEnter .5s ease-in forwards}.header{height:15%;background-color:var(--bg-header-chatbot-box-message);color:var(--color-header-chatbot-box-message);display:inline-flex;align-items:center;justify-content:center;font-weight:600;padding:.25rem .5rem;position:relative}.header-text{font-size:large;width:90%;text-align:center}.icon-right{position:absolute;right:10px;font-size:large;cursor:pointer;padding:.25rem;width:40px;height:auto;aspect-ratio:1/1;display:flex;justify-content:center;align-items:center}.icon-right:hover{border:1px solid white;border-radius:50%}.body{height:75%;width:100%;padding:1rem;display:flex;flex-direction:column;overflow:auto;row-gap:1.5rem}.body::-webkit-scrollbar{width:10px}.body::-webkit-scrollbar-track{box-shadow:inset 0 0 5px var(--gray-400);border-radius:10px}.body::-webkit-scrollbar-thumb{background:var(--chatbot-scrollbar-color);border-radius:10px}.spinner{margin-left:20px;display:flex;column-gap:15px;height:100%;align-items:center}.spinner>div{width:12px;height:12px;background-color:var(--surface-700);border-radius:100%;display:inline-block;-webkit-animation:sk-bouncedelay 1.7s infinite ease-in-out both;animation:sk-bouncedelay 1.47 infinite ease-in-out both}.spinner .bounce1{-webkit-animation-delay:-.64s;animation-delay:-.64s}.spinner .bounce2{-webkit-animation-delay:-.32s;animation-delay:-.32s}.horizontal-line{width:calc(100% - 2rem);border-color:var(--bg-header-chatbot-box-message);transform:translateY(10px)}.chat-container-message{display:flex;align-items:flex-start;column-gap:10px}.svg-container{width:35px;height:35px;border-radius:50%}.chatbot-text{color:var(--teal-700);background-color:#fff;border-radius:10px;border:1px solid var(--bg-chatbot-icon-container);text-align:justify;font-size:small;font-weight:500;width:calc(100% - 80px);margin:0;padding:.5rem .8rem;min-height:100%}.chat-message{background-color:var(--bg-chatbot-icon-container);color:var(--color-chatbot-message)}.chat-error{background-color:#3e4652!important;color:#fff!important}.user-message{background-color:var(--bg-user-icon-container);color:var(--color-user-message)}.chatbot-icon{background-color:var(--bg-chatbot-icon-container);padding:.3rem}.user-icon{padding:.3rem;border:2px solid var(--bg-chatbot-icon-container);background-color:var(--bg-user-icon-container)}.footer{height:fit-content;display:inline-flex;justify-content:space-between;padding:1rem}.send-icon-container{display:flex;justify-content:center;align-items:center;border-radius:50%;background-color:var(--surface-700);color:#fff;height:100%;aspect-ratio:1/1;cursor:pointer}.send-icon-container:hover{border:1px solid var(--bg-header-chatbot-box-message)}.disabled-icon{color:#fff;cursor:not-allowed;background-color:var(--surface-700);opacity:.6}@-webkit-keyframes sk-bouncedelay{0%,80%,to{-webkit-transform:scale(0)}40%{-webkit-transform:scale(1)}}@keyframes sk-bouncedelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}@keyframes onEnter{0%{opacity:0}to{opacity:1}}@keyframes onLeave{0%{opacity:1}to{opacity:0}}\n"], dependencies: [{ kind: "directive", type: NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { kind: "directive", type: NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: TypingDirective, selector: "[libTyping]", inputs: ["text", "nativeContainer"] }, { kind: "ngmodule", type: FormsModule }, { kind: "directive", type: i2.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i2.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i2.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "ngmodule", type: InputTextModule }, { kind: "directive", type: i3.InputText, selector: "[pInputText]", inputs: ["variant"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: ChatbotTextboxComponent, decorators: [{
            type: Component,
            args: [{ selector: 'lib-chatbot-textbox', standalone: true, imports: [NgStyle, NgClass, TypingDirective, FormsModule, InputTextModule], template: "<div class=\"header\">\r\n    <p class=\"header-text\">My chatbot title</p>\r\n    <span class=\"icon-right\"\r\n    (click)=\"onCloseChatbot()\">\r\n      <i class=\"pi pi-times\"></i>\r\n    </span>\r\n  </div>\r\n  \r\n  <div #bodyChatbotContainer \r\n  class=\"body\">\r\n  \r\n  \r\n    @for (chat of  listOfMessages ; track chat; let index=$index )\r\n    {\r\n      <div class=\"chat-container-message\"\r\n      [ngStyle]=\"{'flex-direction': index === 0 || index % 2 === 0 ? 'row' : 'row-reverse'}\"\r\n      >\r\n        <img [src]=\"getIcon(index)\" class=\"svg-container\" alt=\"\" \r\n        [ngClass]=\"index === 0 || index % 2 === 0 ? 'chatbot-icon' : 'user-icon' \" >\r\n        @if(index == 0)\r\n        {\r\n          <p class=\"chatbot-text chat-message\">{{chat.content}}</p>\r\n        }@else {\r\n          @if (index % 2 == 0) {\r\n            <p libTyping [text]=\"chat.content\"\r\n            [ngClass]=\"errorResponse ? 'chat-error' : 'chat-message' \"\r\n            [nativeContainer]=\"bodyChatbotContainer\"\r\n            class=\"chatbot-text\">\r\n              {{chat.content}}\r\n            </p>          \r\n          } @else {\r\n            <p class=\"chatbot-text user-message\">{{chat.content}}</p>\r\n          }\r\n  \r\n        }\r\n      </div>\r\n    }\r\n  \r\n    @if(waitingResponse)\r\n    {  \r\n      <div class=\"chat-container-message\">\r\n        <img [src]=\"icons.chatbotIcon\" class=\"svg-container chatbot-icon\" alt=\"\">\r\n        <div class=\"spinner\">\r\n          <div class=\"bounce1\"></div>\r\n          <div class=\"bounce2\"></div>\r\n          <div class=\"bounce3\"></div>\r\n        </div>\r\n      </div>\r\n    }\r\n  \r\n  </div>\r\n  \r\n  <hr class=\"horizontal-line\">\r\n  <div class=\"footer\">\r\n  \r\n    <input type=\"text\" pInputText\r\n    placeholder=\"Write here your message...\"\r\n    [disabled]=\"waitingResponse\"\r\n    [style]=\"{'border-radius' : '20px' , 'font-size' : 'small' , 'width' : '85%'}\"\r\n    [(ngModel)]=\"inputText\"\r\n    (keydown.enter)=\"onSendForm()\"\r\n    />\r\n  \r\n    <div class=\"send-icon-container\"\r\n    [class.disabled-icon]=\"!inputText\"\r\n    (click)=\"onSendForm()\">\r\n      <i class=\"pi pi-send\"></i>\r\n    </div>\r\n  \r\n  </div>\r\n  \r\n  \r\n  ", styles: [":host{width:25rem;height:35rem;display:flex;flex-direction:column;overflow:hidden;border-radius:10px;position:absolute;right:1rem;bottom:2rem;background-color:var(--bg-textbox);box-shadow:#00000026 1.95px 1.95px 2.6px;animation:onEnter .5s ease-in forwards}.header{height:15%;background-color:var(--bg-header-chatbot-box-message);color:var(--color-header-chatbot-box-message);display:inline-flex;align-items:center;justify-content:center;font-weight:600;padding:.25rem .5rem;position:relative}.header-text{font-size:large;width:90%;text-align:center}.icon-right{position:absolute;right:10px;font-size:large;cursor:pointer;padding:.25rem;width:40px;height:auto;aspect-ratio:1/1;display:flex;justify-content:center;align-items:center}.icon-right:hover{border:1px solid white;border-radius:50%}.body{height:75%;width:100%;padding:1rem;display:flex;flex-direction:column;overflow:auto;row-gap:1.5rem}.body::-webkit-scrollbar{width:10px}.body::-webkit-scrollbar-track{box-shadow:inset 0 0 5px var(--gray-400);border-radius:10px}.body::-webkit-scrollbar-thumb{background:var(--chatbot-scrollbar-color);border-radius:10px}.spinner{margin-left:20px;display:flex;column-gap:15px;height:100%;align-items:center}.spinner>div{width:12px;height:12px;background-color:var(--surface-700);border-radius:100%;display:inline-block;-webkit-animation:sk-bouncedelay 1.7s infinite ease-in-out both;animation:sk-bouncedelay 1.47 infinite ease-in-out both}.spinner .bounce1{-webkit-animation-delay:-.64s;animation-delay:-.64s}.spinner .bounce2{-webkit-animation-delay:-.32s;animation-delay:-.32s}.horizontal-line{width:calc(100% - 2rem);border-color:var(--bg-header-chatbot-box-message);transform:translateY(10px)}.chat-container-message{display:flex;align-items:flex-start;column-gap:10px}.svg-container{width:35px;height:35px;border-radius:50%}.chatbot-text{color:var(--teal-700);background-color:#fff;border-radius:10px;border:1px solid var(--bg-chatbot-icon-container);text-align:justify;font-size:small;font-weight:500;width:calc(100% - 80px);margin:0;padding:.5rem .8rem;min-height:100%}.chat-message{background-color:var(--bg-chatbot-icon-container);color:var(--color-chatbot-message)}.chat-error{background-color:#3e4652!important;color:#fff!important}.user-message{background-color:var(--bg-user-icon-container);color:var(--color-user-message)}.chatbot-icon{background-color:var(--bg-chatbot-icon-container);padding:.3rem}.user-icon{padding:.3rem;border:2px solid var(--bg-chatbot-icon-container);background-color:var(--bg-user-icon-container)}.footer{height:fit-content;display:inline-flex;justify-content:space-between;padding:1rem}.send-icon-container{display:flex;justify-content:center;align-items:center;border-radius:50%;background-color:var(--surface-700);color:#fff;height:100%;aspect-ratio:1/1;cursor:pointer}.send-icon-container:hover{border:1px solid var(--bg-header-chatbot-box-message)}.disabled-icon{color:#fff;cursor:not-allowed;background-color:var(--surface-700);opacity:.6}@-webkit-keyframes sk-bouncedelay{0%,80%,to{-webkit-transform:scale(0)}40%{-webkit-transform:scale(1)}}@keyframes sk-bouncedelay{0%,80%,to{-webkit-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);transform:scale(1)}}@keyframes onEnter{0%{opacity:0}to{opacity:1}}@keyframes onLeave{0%{opacity:1}to{opacity:0}}\n"] }]
        }], ctorParameters: () => [{ type: i1.HttpClient }], propDecorators: { bodyContainer: [{
                type: ViewChild,
                args: ['bodyChatbotContainer', { static: false }]
            }], icons: [{
                type: Input,
                args: [{ required: true }]
            }], basePath: [{
                type: Input,
                args: [{ required: true }]
            }], closeChatbot: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhdGJvdC10ZXh0Ym94LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL215LWNoYXRib3QtbGlicmFyeS9zcmMvbGliL2NoYXRib3QtdGV4dGJveC9jaGF0Ym90LXRleHRib3guY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbXktY2hhdGJvdC1saWJyYXJ5L3NyYy9saWIvY2hhdGJvdC10ZXh0Ym94L2NoYXRib3QtdGV4dGJveC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFjLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUc5RixPQUFPLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNqRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDOzs7OztBQVNwRCxNQUFNLE9BQU8sdUJBQXVCO0lBa0JsQyxZQUFvQixJQUFpQjtRQUFqQixTQUFJLEdBQUosSUFBSSxDQUFhO1FBWjNCLGlCQUFZLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUV6QyxtQkFBYyxHQUFZLDZEQUE2RCxDQUFBO1FBQ3ZGLGlCQUFZLEdBQVksd0NBQXdDLENBQUM7UUFFMUUsb0JBQWUsR0FBYSxLQUFLLENBQUM7UUFDbEMsa0JBQWEsR0FBYSxLQUFLLENBQUM7UUFDaEMsbUJBQWMsR0FDZDtZQUNFLEVBQUMsSUFBSSxFQUFHLFdBQVcsRUFBRyxPQUFPLEVBQUcsSUFBSSxDQUFDLGNBQWMsRUFBQztTQUNyRCxDQUFDO0lBRXFDLENBQUM7SUFFeEMsT0FBTyxDQUFDLEdBQVk7UUFFbEIsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFBO0lBQ25GLENBQUM7SUFFRCxjQUFjO1FBRVosSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUMzQixDQUFDO0lBRUQsVUFBVTtRQUVSLElBQUcsSUFBSSxDQUFDLFNBQVMsSUFBRyxTQUFTLEVBQzdCLENBQUM7WUFDQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRyxNQUFNLEVBQUcsT0FBTyxFQUFXLElBQUksQ0FBQyxTQUFTLEVBQUMsQ0FBQyxDQUFDO1lBQzdFLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1lBQzNCLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO1lBQzVCLDRCQUE0QjtZQUM1QixNQUFNLE9BQU8sR0FBb0IsRUFBQyxLQUFLLEVBQUcsZUFBZSxFQUFHLFFBQVEsRUFBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBQyxDQUFDO1lBQ3JHLGFBQWE7WUFDYixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBa0IsSUFBSSxDQUFDLFFBQVEsRUFBRyxPQUFPLENBQUM7aUJBQ3ZELFNBQVMsQ0FBQztnQkFDVCxJQUFJLEVBQUcsQ0FBQyxHQUFxQixFQUFFLEVBQUU7b0JBQy9CLElBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFDO29CQUM3QixJQUFHLEdBQUcsQ0FBQyxPQUFPLEVBQ2QsQ0FBQzt3QkFDQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRyxXQUFXLEVBQUcsT0FBTyxFQUFHLEdBQUcsQ0FBQyxPQUFPLEVBQUMsQ0FBQyxDQUFDO29CQUN6RSxDQUFDO2dCQUNILENBQUM7Z0JBQ0QsS0FBSyxFQUFHLENBQUMsR0FBUyxFQUFFLEVBQUU7b0JBQ3BCLElBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFDO29CQUM3QixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQztvQkFDMUIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsRUFBQyxJQUFJLEVBQUcsV0FBVyxFQUFHLE9BQU8sRUFBRyxJQUFJLENBQUMsWUFBWSxFQUFDLENBQUMsQ0FBQztnQkFDL0UsQ0FBQzthQUNGLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDOytHQXhEVSx1QkFBdUI7bUdBQXZCLHVCQUF1QixtU0NmcEMseXZFQXdFRSxzeUdEN0RVLE9BQU8sMkVBQUUsT0FBTyxvRkFBRSxlQUFlLDRGQUFHLFdBQVcsOG1CQUFHLGVBQWU7OzRGQUloRSx1QkFBdUI7a0JBUG5DLFNBQVM7K0JBQ0UscUJBQXFCLGNBQ25CLElBQUksV0FDUCxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsZUFBZSxFQUFHLFdBQVcsRUFBRyxlQUFlLENBQUM7K0VBTXRCLGFBQWE7c0JBQWxFLFNBQVM7dUJBQUMsc0JBQXNCLEVBQUcsRUFBQyxNQUFNLEVBQUcsS0FBSyxFQUFDO2dCQUUxQixLQUFLO3NCQUE5QixLQUFLO3VCQUFDLEVBQUMsUUFBUSxFQUFHLElBQUksRUFBQztnQkFDRSxRQUFRO3NCQUFqQyxLQUFLO3VCQUFDLEVBQUMsUUFBUSxFQUFHLElBQUksRUFBQztnQkFDZCxZQUFZO3NCQUFyQixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDaGF0Ym90SWNvbnMsIENoYXRib3RNc2csIENoYXRib3RSZXF1ZXN0LCBDaGF0Ym90UmVzcG9uc2UgfSBmcm9tICcuLi9pbnRlcmZhY2VzL2xpYnJhcnkuaW50ZXJmYWNlJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgTmdDbGFzcywgTmdTdHlsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7IFR5cGluZ0RpcmVjdGl2ZSB9IGZyb20gJy4uL2RpcmVjdGl2ZXMvdHlwaW5nLmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IEZvcm1zTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBJbnB1dFRleHRNb2R1bGUgfSBmcm9tICdwcmltZW5nL2lucHV0dGV4dCc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi1jaGF0Ym90LXRleHRib3gnLFxyXG4gIHN0YW5kYWxvbmU6IHRydWUsXHJcbiAgaW1wb3J0czogW05nU3R5bGUsIE5nQ2xhc3MsIFR5cGluZ0RpcmVjdGl2ZSAsIEZvcm1zTW9kdWxlICwgSW5wdXRUZXh0TW9kdWxlXSxcclxuICB0ZW1wbGF0ZVVybDogJy4vY2hhdGJvdC10ZXh0Ym94LmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybDogJy4vY2hhdGJvdC10ZXh0Ym94LmNvbXBvbmVudC5jc3MnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDaGF0Ym90VGV4dGJveENvbXBvbmVudCB7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ2JvZHlDaGF0Ym90Q29udGFpbmVyJyAsIHtzdGF0aWMgOiBmYWxzZX0pIGJvZHlDb250YWluZXIgITogRWxlbWVudFJlZjtcclxuXHJcbiAgQElucHV0KHtyZXF1aXJlZCA6IHRydWV9KSBpY29ucyAhOiBDaGF0Ym90SWNvbnM7XHJcbiAgQElucHV0KHtyZXF1aXJlZCA6IHRydWV9KSBiYXNlUGF0aCAhOiBzdHJpbmc7XHJcbiAgQE91dHB1dCgpIGNsb3NlQ2hhdGJvdCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcclxuXHJcbiAgcmVhZG9ubHkgd2VsY29tZU1lc3NhZ2UgOiBzdHJpbmcgPSAnSGVsbG8gSVxcJ20gTWFudSB5b3VyIHZpcnR1YWwgYXNzaXN0YW50LiBIb3cgY2FuIEkgaGVscCB5b3U/J1xyXG4gIHJlYWRvbmx5IGVycm9yTWVzc2FnZSA6IHN0cmluZyA9ICdTb21ldGhpbmcgd2VudCB3cm9udC4gUGxlYXNlIHRyeSBsYXRlcic7XHJcbiAgaW5wdXRUZXh0IDogc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG4gIHdhaXRpbmdSZXNwb25zZSA6IGJvb2xlYW4gPSBmYWxzZTtcclxuICBlcnJvclJlc3BvbnNlIDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIGxpc3RPZk1lc3NhZ2VzIDogQ2hhdGJvdE1zZ1tdID0gXHJcbiAgWyBcclxuICAgIHtyb2xlIDogJ2Fzc2lzdGFudCcgLCBjb250ZW50IDogdGhpcy53ZWxjb21lTWVzc2FnZX0gXHJcbiAgXTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwIDogSHR0cENsaWVudCl7fVxyXG5cclxuICBnZXRJY29uKGluZCA6IG51bWJlcikgOiBzdHJpbmdcclxuICB7XHJcbiAgICByZXR1cm4gKGluZCA9PSAwIHx8IGluZCAlIDIgPT0gMCkgPyAgdGhpcy5pY29ucy5jaGF0Ym90SWNvbiA6IHRoaXMuaWNvbnMudXNlckljb25cclxuICB9XHJcblxyXG4gIG9uQ2xvc2VDaGF0Ym90KCkgOiB2b2lkXHJcbiAge1xyXG4gICAgdGhpcy5jbG9zZUNoYXRib3QuZW1pdCgpO1xyXG4gIH1cclxuXHJcbiAgb25TZW5kRm9ybSgpIDogdm9pZFxyXG4gIHtcclxuICAgIGlmKHRoaXMuaW5wdXRUZXh0ICE9dW5kZWZpbmVkKVxyXG4gICAge1xyXG4gICAgICB0aGlzLmxpc3RPZk1lc3NhZ2VzLnB1c2goe3JvbGUgOiAndXNlcicgLCBjb250ZW50IDogPHN0cmluZz50aGlzLmlucHV0VGV4dH0pO1xyXG4gICAgICB0aGlzLmlucHV0VGV4dCA9IHVuZGVmaW5lZDtcclxuICAgICAgdGhpcy53YWl0aW5nUmVzcG9uc2UgPSB0cnVlO1xyXG4gICAgICAvL1JlbW92ZSB0aGUgd2VsY29tZSBtZXNzYWdlXHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgOiBDaGF0Ym90UmVxdWVzdCA9IHttb2RlbCA6IFwiZ3B0LTMuNS10dXJib1wiICwgbWVzc2FnZXMgOiB0aGlzLmxpc3RPZk1lc3NhZ2VzLnNsaWNlKDEpfTtcclxuICAgICAgLy9EbyB0aGUgY2FsbFxyXG4gICAgICB0aGlzLmh0dHAucG9zdDxDaGF0Ym90UmVzcG9uc2U+KHRoaXMuYmFzZVBhdGggLCByZXF1ZXN0KVxyXG4gICAgICAuc3Vic2NyaWJlKHtcclxuICAgICAgICBuZXh0IDogKHJlcyA6IENoYXRib3RSZXNwb25zZSkgPT57XHJcbiAgICAgICAgICB0aGlzLndhaXRpbmdSZXNwb25zZSA9IGZhbHNlO1xyXG4gICAgICAgICAgaWYocmVzLmNvbnRlbnQpXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMubGlzdE9mTWVzc2FnZXMucHVzaCh7cm9sZSA6ICdhc3Npc3RhbnQnICwgY29udGVudCA6IHJlcy5jb250ZW50fSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlcnJvciA6IChlcnIgOiBhbnkpID0+e1xyXG4gICAgICAgICAgdGhpcy53YWl0aW5nUmVzcG9uc2UgPSBmYWxzZTtcclxuICAgICAgICAgIHRoaXMuZXJyb3JSZXNwb25zZSA9IHRydWU7XHJcbiAgICAgICAgICB0aGlzLmxpc3RPZk1lc3NhZ2VzLnB1c2goe3JvbGUgOiAnYXNzaXN0YW50JyAsIGNvbnRlbnQgOiB0aGlzLmVycm9yTWVzc2FnZX0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG4iLCI8ZGl2IGNsYXNzPVwiaGVhZGVyXCI+XHJcbiAgICA8cCBjbGFzcz1cImhlYWRlci10ZXh0XCI+TXkgY2hhdGJvdCB0aXRsZTwvcD5cclxuICAgIDxzcGFuIGNsYXNzPVwiaWNvbi1yaWdodFwiXHJcbiAgICAoY2xpY2spPVwib25DbG9zZUNoYXRib3QoKVwiPlxyXG4gICAgICA8aSBjbGFzcz1cInBpIHBpLXRpbWVzXCI+PC9pPlxyXG4gICAgPC9zcGFuPlxyXG4gIDwvZGl2PlxyXG4gIFxyXG4gIDxkaXYgI2JvZHlDaGF0Ym90Q29udGFpbmVyIFxyXG4gIGNsYXNzPVwiYm9keVwiPlxyXG4gIFxyXG4gIFxyXG4gICAgQGZvciAoY2hhdCBvZiAgbGlzdE9mTWVzc2FnZXMgOyB0cmFjayBjaGF0OyBsZXQgaW5kZXg9JGluZGV4IClcclxuICAgIHtcclxuICAgICAgPGRpdiBjbGFzcz1cImNoYXQtY29udGFpbmVyLW1lc3NhZ2VcIlxyXG4gICAgICBbbmdTdHlsZV09XCJ7J2ZsZXgtZGlyZWN0aW9uJzogaW5kZXggPT09IDAgfHwgaW5kZXggJSAyID09PSAwID8gJ3JvdycgOiAncm93LXJldmVyc2UnfVwiXHJcbiAgICAgID5cclxuICAgICAgICA8aW1nIFtzcmNdPVwiZ2V0SWNvbihpbmRleClcIiBjbGFzcz1cInN2Zy1jb250YWluZXJcIiBhbHQ9XCJcIiBcclxuICAgICAgICBbbmdDbGFzc109XCJpbmRleCA9PT0gMCB8fCBpbmRleCAlIDIgPT09IDAgPyAnY2hhdGJvdC1pY29uJyA6ICd1c2VyLWljb24nIFwiID5cclxuICAgICAgICBAaWYoaW5kZXggPT0gMClcclxuICAgICAgICB7XHJcbiAgICAgICAgICA8cCBjbGFzcz1cImNoYXRib3QtdGV4dCBjaGF0LW1lc3NhZ2VcIj57e2NoYXQuY29udGVudH19PC9wPlxyXG4gICAgICAgIH1AZWxzZSB7XHJcbiAgICAgICAgICBAaWYgKGluZGV4ICUgMiA9PSAwKSB7XHJcbiAgICAgICAgICAgIDxwIGxpYlR5cGluZyBbdGV4dF09XCJjaGF0LmNvbnRlbnRcIlxyXG4gICAgICAgICAgICBbbmdDbGFzc109XCJlcnJvclJlc3BvbnNlID8gJ2NoYXQtZXJyb3InIDogJ2NoYXQtbWVzc2FnZScgXCJcclxuICAgICAgICAgICAgW25hdGl2ZUNvbnRhaW5lcl09XCJib2R5Q2hhdGJvdENvbnRhaW5lclwiXHJcbiAgICAgICAgICAgIGNsYXNzPVwiY2hhdGJvdC10ZXh0XCI+XHJcbiAgICAgICAgICAgICAge3tjaGF0LmNvbnRlbnR9fVxyXG4gICAgICAgICAgICA8L3A+ICAgICAgICAgIFxyXG4gICAgICAgICAgfSBAZWxzZSB7XHJcbiAgICAgICAgICAgIDxwIGNsYXNzPVwiY2hhdGJvdC10ZXh0IHVzZXItbWVzc2FnZVwiPnt7Y2hhdC5jb250ZW50fX08L3A+XHJcbiAgICAgICAgICB9XHJcbiAgXHJcbiAgICAgICAgfVxyXG4gICAgICA8L2Rpdj5cclxuICAgIH1cclxuICBcclxuICAgIEBpZih3YWl0aW5nUmVzcG9uc2UpXHJcbiAgICB7ICBcclxuICAgICAgPGRpdiBjbGFzcz1cImNoYXQtY29udGFpbmVyLW1lc3NhZ2VcIj5cclxuICAgICAgICA8aW1nIFtzcmNdPVwiaWNvbnMuY2hhdGJvdEljb25cIiBjbGFzcz1cInN2Zy1jb250YWluZXIgY2hhdGJvdC1pY29uXCIgYWx0PVwiXCI+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cInNwaW5uZXJcIj5cclxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJib3VuY2UxXCI+PC9kaXY+XHJcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiYm91bmNlMlwiPjwvZGl2PlxyXG4gICAgICAgICAgPGRpdiBjbGFzcz1cImJvdW5jZTNcIj48L2Rpdj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgPC9kaXY+XHJcbiAgICB9XHJcbiAgXHJcbiAgPC9kaXY+XHJcbiAgXHJcbiAgPGhyIGNsYXNzPVwiaG9yaXpvbnRhbC1saW5lXCI+XHJcbiAgPGRpdiBjbGFzcz1cImZvb3RlclwiPlxyXG4gIFxyXG4gICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCIgcElucHV0VGV4dFxyXG4gICAgcGxhY2Vob2xkZXI9XCJXcml0ZSBoZXJlIHlvdXIgbWVzc2FnZS4uLlwiXHJcbiAgICBbZGlzYWJsZWRdPVwid2FpdGluZ1Jlc3BvbnNlXCJcclxuICAgIFtzdHlsZV09XCJ7J2JvcmRlci1yYWRpdXMnIDogJzIwcHgnICwgJ2ZvbnQtc2l6ZScgOiAnc21hbGwnICwgJ3dpZHRoJyA6ICc4NSUnfVwiXHJcbiAgICBbKG5nTW9kZWwpXT1cImlucHV0VGV4dFwiXHJcbiAgICAoa2V5ZG93bi5lbnRlcik9XCJvblNlbmRGb3JtKClcIlxyXG4gICAgLz5cclxuICBcclxuICAgIDxkaXYgY2xhc3M9XCJzZW5kLWljb24tY29udGFpbmVyXCJcclxuICAgIFtjbGFzcy5kaXNhYmxlZC1pY29uXT1cIiFpbnB1dFRleHRcIlxyXG4gICAgKGNsaWNrKT1cIm9uU2VuZEZvcm0oKVwiPlxyXG4gICAgICA8aSBjbGFzcz1cInBpIHBpLXNlbmRcIj48L2k+XHJcbiAgICA8L2Rpdj5cclxuICBcclxuICA8L2Rpdj5cclxuICBcclxuICBcclxuICAiXX0=